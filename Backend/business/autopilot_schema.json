{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "intent",
    "summary",
    "next_best_actions"
  ],
  "properties": {
    "conversation_language": {
      "type": "string",
      "enum": [
        "en",
        "zh"
      ],
      "default": "en"
    },
    "intent": {
      "type": "string",
      "enum": [
        "sales_lead",
        "support_issue",
        "feature_request",
        "bug_report",
        "scheduling",
        "other"
      ]
    },
    "urgency": {
      "type": [
        "string",
        "null"
      ],
      "enum": [
        "low",
        "medium",
        "high",
        null
      ]
    },
    "budget": {
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "required": [
        "currency",
        "range_min",
        "range_max",
        "confidence"
      ],
      "properties": {
        "currency": {
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "range_min": {
          "type": [
            "number",
            "null"
          ],
          "default": null
        },
        "range_max": {
          "type": [
            "number",
            "null"
          ],
          "default": null
        },
        "confidence": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0
        }
      }
    },
    "product_interest": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "default": []
    },
    "entities": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "company": {
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "contact_name": {
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "email": {
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "phone": {
          "type": [
            "string",
            "null"
          ],
          "default": null
        }
      },
      "default": {}
    },
    "summary": {
      "type": "string"
    },
    "next_best_actions": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/definitions/action_item"
      }
    },
    "follow_up_questions": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "default": []
    },
    "confidence_notes": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "default": []
    }
  },
  "definitions": {
    "action_item": {
      "oneOf": [
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "action_type",
            "requires_confirmation",
            "confidence",
            "payload"
          ],
          "properties": {
            "action_type": {
              "const": "create_meeting"
            },
            "requires_confirmation": {
              "type": "boolean",
              "default": true
            },
            "confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "payload": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "date": {
                  "type": "string",
                  "description": "Meeting date in YYYY-MM-DD format. REQUIRED. Extract from conversation or use relative date (e.g., tomorrow, next Monday)."
                },
                "start_time": {
                  "type": "string",
                  "description": "Meeting start time in HH:MM format (24-hour). REQUIRED. Extract from conversation."
                },
                "end_time": {
                  "type": "string",
                  "description": "Meeting end time in HH:MM format (24-hour). REQUIRED. Extract from conversation or infer (default 1 hour after start)."
                },
                "title": {
                  "type": "string",
                  "description": "Meeting title. Use conversation summary if not explicitly mentioned."
                },
                "attendees": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "List of attendee email addresses.",
                  "default": []
                }
              },
              "required": ["title"]
            }
          }
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "action_type",
            "requires_confirmation",
            "confidence",
            "payload"
          ],
          "properties": {
            "action_type": {
              "const": "send_slack_summary"
            },
            "requires_confirmation": {
              "type": "boolean",
              "default": true
            },
            "confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "payload": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "channel": {
                  "type": "string",
                  "description": "Slack channel name (e.g., #general).",
                  "default": "#general"
                },
                "message": {
                  "type": "string",
                  "description": "Message to post to Slack."
                }
              },
              "required": []
            }
          }
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "action_type",
            "requires_confirmation",
            "confidence",
            "payload"
          ],
          "properties": {
            "action_type": {
              "const": "send_email_followup"
            },
            "requires_confirmation": {
              "type": "boolean",
              "default": true
            },
            "confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "payload": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "to": {
                  "type": "string",
                  "description": "Recipient email address. REQUIRED."
                },
                "subject": {
                  "type": "string",
                  "description": "Email subject line."
                },
                "body": {
                  "type": "string",
                  "description": "Email body content."
                }
              },
              "required": []
            }
          }
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "action_type",
            "requires_confirmation",
            "confidence",
            "payload"
          ],
          "properties": {
            "action_type": {
              "const": "create_ticket"
            },
            "requires_confirmation": {
              "type": "boolean",
              "default": true
            },
            "confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "payload": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "title": {
                  "type": "string",
                  "description": "Ticket title."
                },
                "description": {
                  "type": "string",
                  "description": "Ticket description."
                },
                "priority": {
                  "type": "string",
                  "enum": ["low", "medium", "high"],
                  "description": "Ticket priority based on urgency.",
                  "default": "medium"
                }
              },
              "required": []
            }
          }
        },
        {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "action_type",
            "requires_confirmation",
            "confidence",
            "payload"
          ],
          "properties": {
            "action_type": {
              "const": "none"
            },
            "requires_confirmation": {
              "type": "boolean",
              "default": true
            },
            "confidence": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            },
            "payload": {
              "type": "object"
            }
          }
        }
      ]
    }
  }
}